# ğŸš€ í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ: ì™œ ë™ì‹œì„±ì´ ì–´ë ¤ìš´ê°€?

## ğŸ¥º ì‹¤ì œë¡œ ê²ªì–´ë³¸ ë™ì‹œì„± ë¬¸ì œë“¤

### ê°œë°œìë“¤ì´ í”íˆ ë§ˆì£¼ì¹˜ëŠ” ê³ ë¯¼:

**"ì™œ ìŠ¤ë ˆë“œ ì‚¬ìš©í•˜ë©´ ë²„ê·¸ê°€ ë§ì´ ìƒê¸¸ê¹Œ?"**
- ê°™ì€ ì½”ë“œì¸ë° ë©€í‹°ìŠ¤ë ˆë“œì—ì„œë§Œ ì—ëŸ¬ ë°œìƒ
- ë””ë²„ê¹…í•˜ê¸° ë„ˆë¬´ ì–´ë ¤ì›€, ì¬í˜„ë„ ì•ˆ ë¨
- Race condition ë•Œë¬¸ì— ë°ì´í„°ê°€ ì˜¤ì—¼ë¨

**"í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ, ì–´ëŠ ê²Œ ì¢‹ì„ê¹Œ?"**
- ì›¹ ì„œë²„ëŠ” ì™œ ë©€í‹°í”„ë¡œì„¸ìŠ¤ + ë©€í‹°ìŠ¤ë ˆë“œ ì¡°í•©?
- ê²Œì„ ì„œë²„ëŠ” ì‹±ê¸€ í”„ë¡œì„¸ìŠ¤ + ë©€í‹° ìŠ¤ë ˆë“œ?
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” ê°ê° ë‹¤ë¥¸ ì„ íƒ?

**"ë™ì‹œì„± ì´ìŠˆ ë””ë²„ê¹…ì´ ì™œ í˜ë“¤ì§€?"**
- ë¡œì»¬ì—ì„œëŠ” ì •ìƒì¸ë° ìš´ì˜ì—ì„œë§Œ ë°œìƒ
- ìŠ¤ë ˆë“œ ë¤í”„ ë¶„ì„í•˜ëŠ” ë°©ë²• ëª¨ë¦„
- ë°ë“œë½ ê±¸ë ¸ì„ ë•Œ ì–´ë–»ê²Œ í•´ê²°?

## ğŸ¯ 1ë¶„ ìš”ì•½: í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œì˜ í•µì‹¬

**í”„ë¡œì„¸ìŠ¤ = ë…ë¦½ëœ ì§‘, ìŠ¤ë ˆë“œ = ê°™ì€ ì§‘ ì•ˆì˜ ê°€ì¡±**

- **í”„ë¡œì„¸ìŠ¤**: ë…ë¦½ëœ ë©”ëª¨ë¦¬ ê³µê°„, ì„œë¡œ ê°„ì„­ ì•ˆ í•¨ (ì•ˆì „í•˜ì§€ë§Œ ë¬´ê²ë‹¤)
- **ìŠ¤ë ˆë“œ**: ë©”ëª¨ë¦¬ ê³µìœ , ë¹ ë¥¸ í†µì‹  (ë¹ ë¥´ì§€ë§Œ ìœ„í—˜í•¨)
- **ë¬¸ì œ**: ìŠ¤ë ˆë“œì˜ ì¥ì ì´ ê³§ ë‹¨ì  (ê³µìœ  = ì¶©ëŒ ê°€ëŠ¥ì„±)

> **ê²°ë¡ :**
> 1. **ì•ˆì •ì„± ìš°ì„ **: í”„ë¡œì„¸ìŠ¤ ì‚¬ìš© (ì›¹ ì„œë²„)
> 2. **ì„±ëŠ¥ ìš°ì„ **: ìŠ¤ë ˆë“œ ì‚¬ìš© (ê²Œì„, ê³„ì‚°)
> 3. **ë³µì¡ë„ ê´€ë¦¬**: ë™ê¸°í™” ë„êµ¬ í•„ìˆ˜ ì‚¬ìš©
> 
> 

---

## 2. êµ¬ì¡° ë° ì°¨ì´ì  ìƒì„¸ ë¹„êµ

### 2.1 ë©”ëª¨ë¦¬ êµ¬ì¡° (Memory Layout)

ê°€ì¥ í° ì°¨ì´ëŠ” **ë©”ëª¨ë¦¬ ê³µìœ  ì—¬ë¶€**ë‹¤.

**ğŸ’¡ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ:**

| ìƒí™© | í”„ë¡œì„¸ìŠ¤ ì‚¬ìš© | ìŠ¤ë ˆë“œ ì‚¬ìš© |
|------|---------------|-------------|
| **ì›¹ ì„œë²„** | Nginx (ë§ˆìŠ¤í„° + ì›Œì»¤ í”„ë¡œì„¸ìŠ¤) | Node.js (ì‹±ê¸€ í”„ë¡œì„¸ìŠ¤ + ì´ë²¤íŠ¸ ë£¨í”„) |
| **ë°ì´í„°ë² ì´ìŠ¤** | PostgreSQL (í”„ë¡œì„¸ìŠ¤ per ì—°ê²°) | MySQL (ìŠ¤ë ˆë“œ per ì—°ê²°) |
| **ê²Œì„ ì„œë²„** | ë…ë¦½ëœ ê²Œì„ ë£¸ í”„ë¡œì„¸ìŠ¤ | í•œ ê²Œì„ ë‚´ í”Œë ˆì´ì–´ ìŠ¤ë ˆë“œ |

**ğŸš¨ ì‹¤ì œ ë¬¸ì œ ì‚¬ë¡€:**

**ë¬¸ì œ 1: Race Condition (ê²½ìŸ ìƒíƒœ)**
```java
// âŒ ìœ„í—˜í•œ ê³µìœ  ë³€ìˆ˜ ì‚¬ìš©
public class Counter {
    private int count = 0;

    public void increment() {
        count = count + 1;  // ë™ì‹œì— ì‹¤í–‰ë˜ë©´ ê°’ì´ ëˆ„ë½ë  ìˆ˜ ìˆìŒ!
    }
}

// ë‘ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì‹¤í–‰í•˜ë©´:
// Thread 1: count = 0 + 1 = 1
// Thread 2: count = 0 + 1 = 1 (ê¸°ëŒ€ê°’ì€ 2)
// ê²°ê³¼: count = 1 (ë²„ê·¸!)
```

```java
// âœ… synchronizedë¡œ ë³´í˜¸
public synchronized void increment() {
    count = count + 1;  // í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì‹¤í–‰
}
```

**ë¬¸ì œ 2: Deadlock (êµì°© ìƒíƒœ)**
```java
// âŒ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥
public void transfer(Account from, Account to, int amount) {
    synchronized (from) {
        synchronized (to) {  // Aâ†’Bì™€ Bâ†’A ë™ì‹œì— ì‹¤í–‰ë˜ë©´ ë°ë“œë½!
            from.withdraw(amount);
            to.deposit(amount);
        }
    }
}
```

**ë¬¸ì œ 3: Context Switching ì˜¤ë²„í—¤ë“œ**
```java
// âŒ ë„ˆë¬´ ë§ì€ ìŠ¤ë ˆë“œ ìƒì„±
for (int i = 0; i < 10000; i++) {
    new Thread(() -> {
        // ê°„ë‹¨í•œ ì‘ì—…
        System.out.println("Hello");
    }).start();  // ìŠ¤ë ˆë“œ ìƒì„± ë¹„ìš©ì´ ì‘ì—…ë³´ë‹¤ í¼!
}
```

### 2.2 ì‹œê°í™” (Mermaid)

```mermaid
graph TD
    subgraph "Process (ë…ë¦½ëœ ë©”ëª¨ë¦¬ ê³µê°„)"
        Code[Code]
        Data[Data]
        Heap[Heap]
        
        subgraph "Thread 1"
            Stack1[Stack]
            Reg1[Registers]
        end
        
        subgraph "Thread 2"
            Stack2[Stack]
            Reg2[Registers]
        end
        
        subgraph "Thread 3"
            Stack3[Stack]
            Reg3[Registers]
        end
    end
    
    Code --- Thread1
    Code --- Thread2
    Code --- Thread3
    Data --- Thread1
    Data --- Thread2
    Data --- Thread3
    Heap --- Thread1
    Heap --- Thread2
    Heap --- Thread3

```

---

## 3. ë™ì‹œì„± ì´ìŠˆ (Concurrency Issues)

ë©€í‹° ìŠ¤ë ˆë“œê°€ "ì–‘ë‚ ì˜ ê²€"ì¸ ì´ìœ ëŠ” **ê³µìœ  ìì›(Shared Resource)** ë•Œë¬¸ì´ë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ë³€ìˆ˜(Data/Heap)ë¥¼ ê±´ë“œë¦¬ë©´ í•„ì—°ì ìœ¼ë¡œ ì‚¬ê³ ê°€ ë‚œë‹¤.

### 3.1 ê²½ìŸ ìƒíƒœ (Race Condition)

ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ê³µìœ  ìì›ì— ë™ì‹œì— ì ‘ê·¼í•˜ì—¬, ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë’¤ë°”ë€ŒëŠ” ë²„ê·¸ë‹¤.

* **ìƒí™©:** ì”ì•¡ 100ì›. ìŠ¤ë ˆë“œ Aê°€ 10ì› ì¶œê¸ˆ, ìŠ¤ë ˆë“œ Bë„ 10ì› ì¶œê¸ˆ ì‹œë„.
* **ê¸°ëŒ€:** 80ì› ë‚¨ìŒ.
* **ì‹¤ì œ:** ë‘˜ ë‹¤ "í˜„ì¬ ì”ì•¡ 100ì›"ì„ ì½ê³  ê³„ì‚°í•¨  ë‘˜ ë‹¤ "90ì› ì €ì¥"  ìµœì¢… ì”ì•¡ 90ì› (10ì› ì¦ë°œ).

### 3.2 êµì°© ìƒíƒœ (Deadlock)

ë‘ ìŠ¤ë ˆë“œê°€ ì„œë¡œê°€ ê°€ì§„ ìì›ì„ ê¸°ë‹¤ë¦¬ë©° ë¬´í•œ ëŒ€ê¸°ì— ë¹ ì§€ëŠ” ìƒíƒœë‹¤.

* **ì¡°ê±´:** ìŠ¤ë ˆë“œ AëŠ” `ìì› 1`ì„ ì¡ê³  `ìì› 2`ë¥¼ ì›í•¨. ìŠ¤ë ˆë“œ BëŠ” `ìì› 2`ë¥¼ ì¡ê³  `ìì› 1`ì„ ì›í•¨.
* **ê²°ê³¼:** ì˜ì›íˆ ë©ˆì¶¤. (ì‹ì‚¬í•˜ëŠ” ì² í•™ì ë¬¸ì œ)

---

## 4. í•´ê²°ì±…: ë™ê¸°í™” (Synchronization)

ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **"í•œ ë²ˆì— í•œ ë†ˆë§Œ ì¨ë¼"**ë¼ëŠ” ê·œì¹™ì„ ê°•ì œí•˜ëŠ” ë„êµ¬ë“¤ì´ë‹¤.

### 4.1 Mutex vs Semaphore

ë©´ì ‘ ë‹¨ê³¨ ì§ˆë¬¸ì´ë‹¤.

| êµ¬ë¶„ | ë®¤í…ìŠ¤ (Mutex) | ì„¸ë§ˆí¬ì–´ (Semaphore) |
| --- | --- | --- |
| **ë¹„ìœ ** | **í™”ì¥ì‹¤ ì—´ì‡  (1ê°œ).** | **ë¹ˆë°© ì•Œë¦¼íŒ (Nê°œ).** |
| **ì†Œìœ ê¶Œ** | ì—´ì‡ ë¥¼ ê°€ì§„ ìŠ¤ë ˆë“œë§Œ ì ê¸ˆì„ í•´ì œ(Unlock)í•  ìˆ˜ ìˆìŒ. | ì†Œìœ ê¶Œì´ ì—†ìŒ. ëˆ„êµ¬ë“  ì‹ í˜¸(Signal)ë¥¼ ë³´ë‚´ ìˆ«ìë¥¼ ì¡°ì ˆ ê°€ëŠ¥. |
| **ê°œìˆ˜** | 1 (Binary) | N (Counting Semaphore) |
| **ëª©ì ** | ìƒí˜¸ ë°°ì œ (Mutual Exclusion) | ìì› ì ‘ê·¼ ì œì–´ ë° ìˆœì„œ ì¡°ì • |

---

## 5. Production-Ready Code Example (Python)

**[Bad Case: Race Condition]**

```python
import threading

# ê³µìœ  ìì›
balance = 0

def deposit(amount):
    global balance
    # ì—¬ê¸°ì„œ ì½ê¸°(read)ì™€ ì“°ê¸°(write) ì‚¬ì´ì— ë¬¸ë§¥ êµí™˜ì´ ì¼ì–´ë‚˜ë©´ ë°ì´í„°ê°€ ì”¹í˜
    current = balance 
    balance = current + amount

threads = []
for _ in range(100000):
    t = threading.Thread(target=deposit, args=(1,))
    threads.append(t)
    t.start()

for t in threads:
    t.join()

# ê¸°ëŒ€ê°’: 100000, ì‹¤ì œê°’: 98421 (ë§¤ë²ˆ ë‹¤ë¦„)
print(f"Final Balance: {balance}")

```

**[Good Case: Using Mutex (Lock)]**

```python
import threading

balance = 0
# ë®¤í…ìŠ¤(Lock) ìƒì„±
lock = threading.Lock()

def deposit_safe(amount):
    global balance
    # ì„ê³„ ì˜ì—­(Critical Section) ì§„ì… ì „ ì ê¸ˆ
    with lock: 
        current = balance
        balance = current + amount
    # with ë¸”ë¡ì„ ë‚˜ê°€ë©´ ìë™ìœ¼ë¡œ ì ê¸ˆ í•´ì œ (Unlock)

# ... (ì‹¤í–‰ ì½”ë“œëŠ” ìœ„ì™€ ë™ì¼)
# ê²°ê³¼: í•­ìƒ 100000 ë³´ì¥

```

---

## 6. ë” ë‚˜ì€ ì ‘ê·¼ ë°©ì‹ (Industry Standard)

ë‹¨ìˆœíˆ OS ìŠ¤ë ˆë“œë¥¼ ì“°ëŠ” ê²ƒë³´ë‹¤ ë” íš¨ìœ¨ì ì¸ ìµœì‹  ê¸°ìˆ ë“¤ì´ ìˆë‹¤.

### 6.1 í¬ë¡¬ì˜ ë©€í‹° í”„ë¡œì„¸ìŠ¤ ì•„í‚¤í…ì²˜

ê³¼ê±° ë¸Œë¼ìš°ì €ëŠ” íƒ­ì´ 100ê°œì—¬ë„ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ì˜€ë‹¤. íƒ­ í•˜ë‚˜ê°€ ë©ˆì¶”ë©´ ë¸Œë¼ìš°ì € ì „ì²´ê°€ êº¼ì¡Œë‹¤.

* **Chrome:** **íƒ­ë§ˆë‹¤ ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤**ë¥¼ ë„ìš´ë‹¤. ë©”ëª¨ë¦¬ëŠ” ë§ì´ ë¨¹ì§€ë§Œ(íƒ­ë§ˆë‹¤ ë Œë”ë§ ì—”ì§„ ë¡œë”©), íƒ­ í•˜ë‚˜ê°€ ì£½ì–´ë„ ì „ì²´ëŠ” ì‚°ë‹¤(Isolation).

### 6.2 ê²½ëŸ‰ ìŠ¤ë ˆë“œ (User-level Thread)

OS ìŠ¤ë ˆë“œëŠ” ìƒì„± ë¹„ìš©ì´ ë¹„ì‹¸ê³  ê°œìˆ˜ ì œí•œì´ ìˆë‹¤. (Context Switching ë¹„ìš© ë°œìƒ)

* **Go (Goroutine):** OS ìŠ¤ë ˆë“œ 1ê°œ ìœ„ì— ìˆ˜ì²œ ê°œì˜ ê³ ë£¨í‹´(ì‚¬ìš©ì ìˆ˜ì¤€ ìŠ¤ë ˆë“œ)ì„ ì˜¬ë¦°ë‹¤(M:N ëª¨ë¸). ìŠ¤íƒ í¬ê¸°ê°€ 2KBë¡œ ë§¤ìš° ì‘ê³  ìŠ¤ìœ„ì¹­ì´ ë¹ ë¥´ë‹¤.
* **Java (Virtual Threads - Project Loom):** JDK 21ë¶€í„° ë„ì…. ê¸°ì¡´ ìŠ¤ë ˆë“œì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ OS ìŠ¤ë ˆë“œì— 1:1 ë§¤í•‘ë˜ì§€ ì•ŠëŠ” ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ì§€ì›í•œë‹¤.

---

## 7. ì „ë¬¸ê°€ì  ì¡°ì–¸ (Pro Tip)

### 7.1 Pythonì˜ GIL (Global Interpreter Lock)

"íŒŒì´ì¬ì€ ë©€í‹° ìŠ¤ë ˆë“œë¥¼ ì¨ë„ CPU ì½”ì–´ë¥¼ 1ê°œë°–ì— ëª» ì“´ë‹¤"ëŠ” ë§ì„ ë“¤ì–´ë´¤ì„ ê²ƒì´ë‹¤.

* **ì´ìœ :** íŒŒì´ì¬ ì¸í„°í”„ë¦¬í„°(CPython)ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ Thread-safe í•˜ì§€ ì•Šì•„ì„œ, **í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡** ê±°ëŒ€í•œ ë½(GIL)ì„ ê±¸ì–´ë†¨ê¸° ë•Œë¬¸ì´ë‹¤.
* **ëŒ€ì•ˆ:** CPU ì—°ì‚°ì´ ë§ì€ ì‘ì—…(AI, ì´ë¯¸ì§€ ì²˜ë¦¬)ì€ `multiprocessing` ëª¨ë“ˆì„ ì¨ì„œ **í”„ë¡œì„¸ìŠ¤**ë¥¼ ì—¬ëŸ¬ ê°œ ë„ì›Œì•¼ í•œë‹¤. (I/O ì‘ì—…ì€ ë©€í‹° ìŠ¤ë ˆë“œë„ íš¨ê³¼ ìˆìŒ)

### 7.2 Thread-safe ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

ì§ì ‘ `Lock`ì„ ê±¸ë©´ ì‹¤ìˆ˜í•  í™•ë¥ ì´ ë†’ê³ , ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤. ì–¸ì–´ ì°¨ì›ì—ì„œ ì œê³µí•˜ëŠ” **Concurrent Collection**ì„ ì‚¬ìš©í•˜ë¼.

* Java: `HashMap` (X)  `ConcurrentHashMap` (O)
* Java: `ArrayList` (X)  `CopyOnWriteArrayList` (O)

---

## 8. ì‹¤ë¬´ ë¬¸ì œ í•´ê²° ì‚¬ë¡€

### 8.1 ì›¹ ì„œë²„ì˜ C10K ë¬¸ì œ í•´ê²° (Apache vs Nginx)

**ë¬¸ì œ ìƒí™©:**
- 1990ë…„ëŒ€ Apache ì›¹ ì„œë²„ì˜ ìŠ¤ë ˆë“œ ëª¨ë¸ í•œê³„
- ì—°ê²° 10,000ê°œ(C10K)ë§Œ ë˜ì–´ë„ ì„œë²„ê°€ ë‹¤ìš´ë¨
- ê° HTTP ìš”ì²­ë§ˆë‹¤ ìŠ¤ë ˆë“œ 1ê°œ í• ë‹¹ ë°©ì‹ì˜ ë¹„íš¨ìœ¨ì„±

**ê¸°ì¡´ Apache ë°©ì‹ì˜ ë¬¸ì œ:**
```c
// Apacheì˜ ìŠ¤ë ˆë“œ ê¸°ë°˜ ëª¨ë¸ (ê°œë…ì )
void handle_request(int client_socket) {
    // 1. ìŠ¤ë ˆë“œ ìƒì„± (ì˜¤ë²„í—¤ë“œ í¼)
    pthread_create(&thread, NULL, process_request, &client_socket);

    // ê° ìš”ì²­ë§ˆë‹¤ 1MB ìŠ¤íƒ ë©”ëª¨ë¦¬ + ì»¤ë„ ë¦¬ì†ŒìŠ¤ ì†Œë¹„
    // 10,000ê°œ ì—°ê²° = 10GB ë©”ëª¨ë¦¬ + ë¬¸ë§¥ êµí™˜ ì˜¤ë²„í—¤ë“œ
}
```

**Nginxì˜ í”„ë¡œì„¸ìŠ¤ ëª¨ë¸ í•´ê²°:**
```c
// Nginxì˜ ì´ë²¤íŠ¸ ê¸°ë°˜ + í”„ë¡œì„¸ìŠ¤ ëª¨ë¸
int main() {
    // 1. ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ ìƒì„±
    pid_t master_pid = fork_master_process();

    // 2. ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ë“¤ ìƒì„± (CPU ì½”ì–´ ìˆ˜ë§Œí¼)
    for (int i = 0; i < num_cores; i++) {
        pid_t worker_pid = fork_worker_process();

        // ê° ì›Œì»¤ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¡œ ìˆ˜ë§Œ ê°œ ì—°ê²° ì²˜ë¦¬
        event_loop();  // epoll/kqueue ê¸°ë°˜
    }
}
```

**ì•„í‚¤í…ì²˜ ë¹„êµ:**

| ì¸¡ë©´ | Apache (ìŠ¤ë ˆë“œ) | Nginx (í”„ë¡œì„¸ìŠ¤+ì´ë²¤íŠ¸) |
| --- | --- | --- |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©** | 10,000 ì—°ê²° Ã— 1MB = 10GB | ì›Œì»¤ë‹¹ ê³µìœ  ë©”ëª¨ë¦¬ |
| **ë¬¸ë§¥ êµí™˜** | ì¦ì€ ìŠ¤ë ˆë“œ ì „í™˜ | ìµœì†Œí•œì˜ í”„ë¡œì„¸ìŠ¤ ì „í™˜ |
| **í™•ì¥ì„±** | C10K í•œê³„ | C10M ê°€ëŠ¥ |
| **ì•ˆì •ì„±** | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œ ë¶ˆì•ˆì • | í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ë¡œ ì•ˆì •ì  |

**ê²°ê³¼:**
- **ì„±ëŠ¥:** 10ë°° ì´ìƒ ì²˜ë¦¬ëŸ‰ ì¦ê°€
- **ì•ˆì •ì„±:** í”„ë¡œì„¸ìŠ¤ í¬ë˜ì‹œê°€ ì „ì²´ ì˜í–¥ ë¯¸ì¹˜ì§€ ì•ŠìŒ
- **íš¨ìœ¨ì„±:** CPU ì‚¬ìš©ë¥  90% â†’ 30% ê°ì†Œ

### 8.2 Node.jsì˜ ì‹±ê¸€ ìŠ¤ë ˆë“œ ì´ë²¤íŠ¸ ë£¨í”„

**ë¬¸ì œ ìƒí™©:**
- Javaì˜ ë©€í‹°ìŠ¤ë ˆë“œ ëª¨ë¸ë¡œëŠ” ë³µì¡í•œ ë™ì‹œì„± ì²˜ë¦¬ ì–´ë ¤ì›€
- ì½œë°± ì§€ì˜¥(Callback Hell)ê³¼ ê²½ìŸ ìƒíƒœ ë¬¸ì œ
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ì™€ GC ë¶€í•˜

**Node.jsì˜ í˜ì‹ ì  ì ‘ê·¼:**
```javascript
// ì´ë²¤íŠ¸ ë£¨í”„ ê¸°ë°˜ ë™ì‹œì„±
const http = require('http');

const server = http.createServer((req, res) => {
    // 1. I/O ì‘ì—…ì€ ë…¼ë¸”ë¡œí‚¹ìœ¼ë¡œ ìœ„ì„
    fs.readFile('/path/to/file', (err, data) => {
        // 3. I/O ì™„ë£Œ ì‹œì ì— ì½œë°± ì‹¤í–‰
        res.end(data);
    });

    // 2. ë©”ì¸ ìŠ¤ë ˆë“œëŠ” ì¦‰ì‹œ ë‹¤ìŒ ìš”ì²­ ì²˜ë¦¬ ê°€ëŠ¥
});

// ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ìˆ˜ë§Œ ê°œ ì—°ê²° ì²˜ë¦¬
server.listen(3000);
```

**ì´ë²¤íŠ¸ ë£¨í”„ ì‘ë™ ì›ë¦¬:**
```
â””â”€â”€ ì´ë²¤íŠ¸ ë£¨í”„
    â”œâ”€â”€ íƒ€ì´ë¨¸ í (setTimeout, setInterval)
    â”œâ”€â”€ I/O ì½œë°± í (íŒŒì¼, ë„¤íŠ¸ì›Œí¬)
    â”œâ”€â”€ ì²´í¬ í (setImmediate)
    â”œâ”€â”€ close ì½œë°± í
    â””â”€â”€ nextTick í (í”„ë¡œì„¸ìŠ¤.nextTick)
```

**ì„±ëŠ¥ ë©”íŠ¸ë¦­:**
- **ì²˜ë¦¬ëŸ‰:** ì´ˆë‹¹ 10,000+ ìš”ì²­
- **ë©”ëª¨ë¦¬:** ìŠ¤ë ˆë“œë‹¹ 10MB vs Node.js 30MB
- **ì‘ë‹µì„±:** 50ms vs 5ms (I/O ëŒ€ê¸° ì‹œê°„ ì ˆì•½)

### 8.3 ë°ì´í„°ë² ì´ìŠ¤ì˜ ì—°ê²° í’€ êµ¬í˜„

**ë¬¸ì œ ìƒí™©:**
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB ì—°ê²° ìƒì„±/ì‚­ì œ ì˜¤ë²„í—¤ë“œ
- ë™ì‹œ ìš”ì²­ ì‹œ ì—°ê²° ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜
- ì—°ê²° ëˆ„ìˆ˜ë¡œ ì¸í•œ ë¦¬ì†ŒìŠ¤ ê³ ê°ˆ

**HikariCPì˜ í”„ë¡œì„¸ìŠ¤ ëª¨ë¸:**
```java
// HikariCP ì—°ê²° í’€ ì„¤ì •
HikariConfig config = new HikariConfig();
config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
config.setUsername("user");
config.setPassword("password");

// ìµœì í™”ëœ ì„¤ì •
config.setMaximumPoolSize(10);           // ìµœëŒ€ ì—°ê²° ìˆ˜
config.setMinimumIdle(5);                // ìµœì†Œ ìœ íœ´ ì—°ê²°
config.setConnectionTimeout(30000);      // ì—°ê²° ëŒ€ê¸° ì‹œê°„
config.setIdleTimeout(600000);           // ìœ íœ´ ì—°ê²° ì œê±° ì‹œê°„
config.setMaxLifetime(1800000);          // ì—°ê²° ìµœëŒ€ ìˆ˜ëª…

HikariDataSource ds = new HikariDataSource(config);
```

**ì—°ê²° í’€ ë©”ì»¤ë‹ˆì¦˜:**
1. **ì´ˆê¸°í™”:** ìµœì†Œ ê°œìˆ˜ë§Œí¼ ì—°ê²° ë¯¸ë¦¬ ìƒì„±
2. **ëŒ€ì—¬:** ìš”ì²­ ì‹œ ìœ íœ´ ì—°ê²° ì¦‰ì‹œ ì œê³µ
3. **ë°˜í™˜:** ì‚¬ìš© í›„ ì—°ê²°ì„ í’€ì— ë°˜í™˜
4. **ê´€ë¦¬:** ìœ íœ´ ì—°ê²° ì •ë¦¬, ì£½ì€ ì—°ê²° ì œê±°

**ì„±ëŠ¥ í–¥ìƒ:**
- **ì—°ê²° ì‹œê°„:** 50ms â†’ 1ms
- **ì²˜ë¦¬ëŸ‰:** 100 req/s â†’ 1000 req/s
- **ì•ˆì •ì„±:** ì—°ê²° ëˆ„ìˆ˜ ë°©ì§€, ìë™ ë³µêµ¬

### 8.4 ì‹¤ì‹œê°„ ì±„íŒ… ì‹œìŠ¤í…œì˜ ìŠ¤ë ˆë“œ ëª¨ë¸

**ë¬¸ì œ ìƒí™©:**
- ìˆ˜ë§Œ ëª… ë™ì‹œ ì ‘ì† ì±„íŒ… ì„œë¹„ìŠ¤
- ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸ì˜ íš¨ìœ¨ì„±
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ê³¼ CPU ë¶€í•˜

**ê¸°ì¡´ ìŠ¤ë ˆë“œ ëª¨ë¸ì˜ ë¬¸ì œ:**
```java
// ê° í´ë¼ì´ì–¸íŠ¸ë§ˆë‹¤ ìŠ¤ë ˆë“œ í• ë‹¹ (ë¹„íš¨ìœ¨ì )
class ChatServer {
    private List<ClientHandler> clients = new ArrayList<>();

    public void broadcast(String message) {
        for (ClientHandler client : clients) {
            // ê° í´ë¼ì´ì–¸íŠ¸ë§ˆë‹¤ ìŠ¤ë ˆë“œ ìƒì„±
            new Thread(() -> client.send(message)).start();
        }
    }
}
```

**ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ëª¨ë¸ë¡œ ê°œì„ :**
```java
// Netty ê¸°ë°˜ ì´ë²¤íŠ¸ ë£¨í”„
public class ChatServer {
    private EventLoopGroup bossGroup = new NioEventLoopGroup(1);
    private EventLoopGroup workerGroup = new NioEventLoopGroup();

    public void start() {
        ServerBootstrap b = new ServerBootstrap();
        b.group(bossGroup, workerGroup)
         .channel(NioServerSocketChannel.class)
         .childHandler(new ChannelInitializer<SocketChannel>() {
             @Override
             protected void initChannel(SocketChannel ch) {
                 ch.pipeline().addLast(new ChatHandler());
             }
         });

        ChannelFuture f = b.bind(8080).sync();
        f.channel().closeFuture().sync();
    }
}

class ChatHandler extends SimpleChannelInboundHandler<String> {
    private static final ChannelGroup channels = new DefaultChannelGroup(GlobalEventExecutor.INSTANCE);

    @Override
    public void handlerAdded(ChannelHandlerContext ctx) {
        channels.add(ctx.channel());
    }

    @Override
    protected void channelRead0(ChannelHandlerContext ctx, String msg) {
        // ì´ë²¤íŠ¸ ë£¨í”„ì—ì„œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
        channels.writeAndFlush(msg + '\n');
    }
}
```

**ì•„í‚¤í…ì²˜ ë¹„êµ:**

| ì¸¡ë©´ | ìŠ¤ë ˆë“œ ëª¨ë¸ | ì´ë²¤íŠ¸ ë“œë¦¬ë¸ |
| --- | --- | --- |
| **ë™ì‹œ ì ‘ì†** | 1,000ê°œ | 100,000ê°œ |
| **ë©”ëª¨ë¦¬** | 1GB (1K ìŠ¤ë ˆë“œ) | 100MB |
| **CPU** | ë¬¸ë§¥ êµí™˜ ë¶€í•˜ | ì´ë²¤íŠ¸ ì²˜ë¦¬ íš¨ìœ¨ |
| **ì½”ë“œ ë³µì¡ë„** | ë‚®ìŒ | ë†’ìŒ |

### 8.5 ê²Œì„ ì„œë²„ì˜ í”„ë¡œì„¸ìŠ¤ ì•„í‚¤í…ì²˜

**ë¬¸ì œ ìƒí™©:**
- MMORPGì˜ ìˆ˜ì‹­ë§Œ ë™ì‹œ ì ‘ì†
- ê²Œì„ ë¡œì§ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ ìš”êµ¬ì‚¬í•­
- ì„œë²„ ì¥ì•  ì‹œ ìµœì†Œ ì˜í–¥ ë²”ìœ„

**ê²Œì„ ì„œë²„ ì•„í‚¤í…ì²˜:**
```cpp
// ë¶„ì‚°ëœ í”„ë¡œì„¸ìŠ¤ ì•„í‚¤í…ì²˜
class GameServer {
public:
    void initialize() {
        // 1. ë¡œê·¸ì¸ ì„œë²„ (í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬)
        loginProcess = fork_login_server();

        // 2. ê²Œì„ ì›”ë“œ ì„œë²„ë“¤ (ì—¬ëŸ¬ ê°œ)
        for (int i = 0; i < num_worlds; i++) {
            worldProcesses[i] = fork_world_server(i);
        }

        // 3. ì±„íŒ… ì„œë²„
        chatProcess = fork_chat_server();

        // 4. ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„
        dbProcess = fork_database_server();
    }

    void handle_crash(pid_t crashed_pid) {
        // í”„ë¡œì„¸ìŠ¤ í¬ë˜ì‹œ ê°ì§€ ë° ë³µêµ¬
        if (crashed_pid == loginProcess) {
            restart_login_server();
        } else {
            // ë‹¤ë¥¸ ì„œë²„ë“¤ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ
            restart_world_server(crashed_pid);
        }
    }
};
```

**í”„ë¡œì„¸ìŠ¤ ë¶„ë¦¬ ì „ëµ:**
- **ë¡œê·¸ì¸ ì„œë²„:** ì¸ì¦ ë¡œì§ë§Œ ë‹´ë‹¹
- **ì›”ë“œ ì„œë²„:** ê²Œì„ ë¡œì§ ë¶„ì‚° ì²˜ë¦¬
- **ì±„íŒ… ì„œë²„:** ë©”ì‹œì§• ì „ìš©
- **DB ì„œë²„:** ë°ì´í„° ì˜ì†í™”

**ì¥ì :**
- **ê²©ë¦¬ì„±:** í•œ ì„œë²„ ì¥ì• ê°€ ì „ì²´ ì˜í–¥ ë¯¸ì¹˜ì§€ ì•ŠìŒ
- **í™•ì¥ì„±:** ì›”ë“œë³„ë¡œ ë…ë¦½ì  ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥
- **ìœ ì§€ë³´ìˆ˜:** ê° ì»´í¬ë„ŒíŠ¸ë³„ ë…ë¦½ì  ë°°í¬

---

## 9. ëŒ€ê·œëª¨ ì—°ê²° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¦¬ì†ŒìŠ¤ ì œí•œ í•´ì œ

ë™ì‹œ ì ‘ì†ì´ ë§ì€ ì„œë²„(ì›¹ ì„œë²„, ê²Œì„ ì„œë²„, ì±„íŒ… ì„œë²„)ë¥¼ ìš´ì˜í•  ë•Œ ê°€ì¥ ë¨¼ì € ë¶€ë”ªíˆëŠ” ë²½ì´ **OS ë¦¬ì†ŒìŠ¤ ì œí•œ**ì´ë‹¤.

### 9.1 File Descriptor (FD)ë€?

**ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” "ëª¨ë“  ê²ƒì´ íŒŒì¼"ì´ë‹¤** - ì†Œì¼“ë„ íŒŒì¼ë¡œ ì·¨ê¸‰ëœë‹¤.

```
[File Descriptor ê°œë…]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í”„ë¡œì„¸ìŠ¤                              â”‚
â”‚                                                         â”‚
â”‚   FD í…Œì´ë¸”:                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ FD  â”‚ ê°€ë¦¬í‚¤ëŠ” ëŒ€ìƒ                   â”‚             â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚   â”‚  0  â”‚ stdin (í‘œì¤€ ì…ë ¥)               â”‚             â”‚
â”‚   â”‚  1  â”‚ stdout (í‘œì¤€ ì¶œë ¥)              â”‚             â”‚
â”‚   â”‚  2  â”‚ stderr (í‘œì¤€ ì—ëŸ¬)              â”‚             â”‚
â”‚   â”‚  3  â”‚ /var/log/app.log (íŒŒì¼)         â”‚             â”‚
â”‚   â”‚  4  â”‚ TCP Socket (192.168.1.1:8080)   â”‚ â† ì†Œì¼“ë„ FD â”‚
â”‚   â”‚  5  â”‚ TCP Socket (192.168.1.2:8080)   â”‚             â”‚
â”‚   â”‚ ... â”‚ ...                             â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë™ì‹œ ì ‘ì† 10,000ëª… = FD 10,000ê°œ ì´ìƒ í•„ìš”!
```

### 9.2 "Too many open files" ì—ëŸ¬

```bash
# ë¬¸ì œ ìƒí™©: ë™ì‹œ ì ‘ì† 2000ëª… ì´ìƒ ì‹œ ì—ëŸ¬ ë°œìƒ
$ tail -f /var/log/app.log
[ERROR] accept() failed: Too many open files
[ERROR] socket() failed: Too many open files
```

**ì›ì¸: FD ì œí•œì— ê±¸ë¦¼**

```bash
# í˜„ì¬ ì œí•œ í™•ì¸
$ ulimit -n
1024  # ê¸°ë³¸ê°’: í”„ë¡œì„¸ìŠ¤ë‹¹ 1024ê°œ íŒŒì¼ë§Œ ì—´ ìˆ˜ ìˆìŒ

# ì‹œìŠ¤í…œ ì „ì²´ FD ì‚¬ìš©ëŸ‰ í™•ì¸
$ cat /proc/sys/fs/file-nr
3200    0    6815744
# í˜„ì¬ ì‚¬ìš© ì¤‘ / í• ë‹¹ëì§€ë§Œ ë¯¸ì‚¬ìš© / ìµœëŒ€ê°’
```

### 9.3 ulimit ì„¤ì • (Soft/Hard Limit)

```bash
# === ì„ì‹œ ì„¤ì • (í˜„ì¬ ì„¸ì…˜ë§Œ) ===
$ ulimit -n 65535

# === ì˜êµ¬ ì„¤ì • ===
# /etc/security/limits.conf

# í˜•ì‹: <ìœ ì €>  <soft/hard>  <í•­ëª©>  <ê°’>

# íŠ¹ì • ìœ ì €
nginx    soft    nofile    65535
nginx    hard    nofile    65535

# ëª¨ë“  ìœ ì € (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
*        soft    nofile    65535
*        hard    nofile    65535

# systemd ì„œë¹„ìŠ¤ì˜ ê²½ìš° ë³„ë„ ì„¤ì • í•„ìš”
# /etc/systemd/system/myapp.service
[Service]
LimitNOFILE=65535
```

**Soft Limit vs Hard Limit:**

| êµ¬ë¶„ | ì„¤ëª… | ëˆ„ê°€ ë³€ê²½ ê°€ëŠ¥? |
|------|------|----------------|
| **Soft Limit** | í˜„ì¬ ì ìš©ë˜ëŠ” ì œí•œ | ì¼ë°˜ ìœ ì € (Hardê¹Œì§€) |
| **Hard Limit** | Softì˜ ìµœëŒ€ ìƒí•œì„  | rootë§Œ ë³€ê²½ ê°€ëŠ¥ |

### 9.4 ì‹œìŠ¤í…œ ì „ì—­ FD ì œí•œ

í”„ë¡œì„¸ìŠ¤ë³„ ì œí•œ ì™¸ì—, **ì‹œìŠ¤í…œ ì „ì²´**ì—ë„ ì œí•œì´ ìˆë‹¤.

```bash
# /etc/sysctl.conf ë˜ëŠ” /etc/sysctl.d/99-file-limits.conf

# ì‹œìŠ¤í…œ ì „ì²´ ìµœëŒ€ FD ìˆ˜
fs.file-max = 2097152

# ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ê°€ ì—´ ìˆ˜ ìˆëŠ” FD ìµœëŒ€ ìˆ˜
fs.nr_open = 2097152

# ì ìš©
$ sysctl -p
```

### 9.5 I/O ëª¨ë¸ê³¼ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬

**ë¬¸ì œ: Blocking I/O + ìŠ¤ë ˆë“œ ëª¨ë¸ì˜ í•œê³„**

```
[Blocking I/O ëª¨ë¸]

í´ë¼ì´ì–¸íŠ¸ 1 â”€â”€â”€â”€â”€â†’ ìŠ¤ë ˆë“œ 1 â”€â”€â”€â†’ recv() â”€â”€â”€ ëŒ€ê¸°ì¤‘... â”€â”€â”€â†’ ì²˜ë¦¬
í´ë¼ì´ì–¸íŠ¸ 2 â”€â”€â”€â”€â”€â†’ ìŠ¤ë ˆë“œ 2 â”€â”€â”€â†’ recv() â”€â”€â”€ ëŒ€ê¸°ì¤‘... â”€â”€â”€â†’ ì²˜ë¦¬
í´ë¼ì´ì–¸íŠ¸ 3 â”€â”€â”€â”€â”€â†’ ìŠ¤ë ˆë“œ 3 â”€â”€â”€â†’ recv() â”€â”€â”€ ëŒ€ê¸°ì¤‘... â”€â”€â”€â†’ ì²˜ë¦¬
...
í´ë¼ì´ì–¸íŠ¸ 10000 â†’ ìŠ¤ë ˆë“œ 10000 â†’ recv() â”€ ëŒ€ê¸°ì¤‘... â”€â†’ ì²˜ë¦¬

âš ï¸ ë¬¸ì œ:
- 10,000ê°œ ìŠ¤ë ˆë“œ = 10GB ë©”ëª¨ë¦¬ (ìŠ¤ë ˆë“œë‹¹ 1MB ìŠ¤íƒ)
- Context Switching ì˜¤ë²„í—¤ë“œ í­ë°œ
- CPUëŠ” 10% ë°–ì— ì•ˆ ì“°ëŠ”ë° ì„œë²„ê°€ í„°ì§
```

**í•´ê²°ì±…: Non-blocking I/O + Event Loop (ë©€í‹°í”Œë ‰ì‹±)**

```
[Event Loop ëª¨ë¸ (epoll/kqueue)]

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         ì´ë²¤íŠ¸ ë£¨í”„ (1ê°œ ìŠ¤ë ˆë“œ)       â”‚
                    â”‚                                       â”‚
í´ë¼ì´ì–¸íŠ¸ 1 â”€â”€â”€â”€â”€â”€â”€â”¤   epoll_wait()ë¡œ 10,000ê°œ ì†Œì¼“ ê°ì‹œ   â”‚
í´ë¼ì´ì–¸íŠ¸ 2 â”€â”€â”€â”€â”€â”€â”€â”¤                                       â”‚
í´ë¼ì´ì–¸íŠ¸ 3 â”€â”€â”€â”€â”€â”€â”€â”¤   â†’ ë°ì´í„° ì˜¨ ì†Œì¼“ë§Œ ì²˜ë¦¬             â”‚
...                 â”‚   â†’ ë‚˜ë¨¸ì§€ëŠ” ëŒ€ê¸° (CPU ì•ˆ ì”€)         â”‚
í´ë¼ì´ì–¸íŠ¸ 10000 â”€â”€â”€â”¤                                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… ì¥ì :
- 1ê°œ ìŠ¤ë ˆë“œë¡œ 10,000ê°œ ì—°ê²° ì²˜ë¦¬
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê·¹ì†Œ (ìˆ˜ì‹­ MB)
- Context Switching ì—†ìŒ
```

### 9.6 I/O ëª¨ë¸ ë¹„êµ

| ëª¨ë¸ | ë™ì‘ ë°©ì‹ | ì¥ì  | ë‹¨ì  | ì‚¬ìš© ì˜ˆ |
|------|----------|------|------|--------|
| **Blocking I/O** | read()ê°€ ë°ì´í„° ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸° | ì½”ë“œ ë‹¨ìˆœ | ëŒ€ê·œëª¨ ì—°ê²° ë¶ˆê°€ | ê°„ë‹¨í•œ CLI íˆ´ |
| **Non-blocking I/O** | read()ê°€ ì¦‰ì‹œ ë°˜í™˜ (EAGAIN) | ìŠ¤ë ˆë“œ ì ìœ  ì•ˆ í•¨ | í´ë§ í•„ìš” | ì €ìˆ˜ì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **I/O Multiplexing** | select/poll/epollë¡œ ë‹¤ì¤‘ FD ê°ì‹œ | ëŒ€ê·œëª¨ ì—°ê²° ì²˜ë¦¬ | ì½œë°± ë³µì¡ | Nginx, Node.js |
| **Async I/O (io_uring)** | ì»¤ë„ì´ ì™„ë£Œ í†µì§€ | ìµœê³  ì„±ëŠ¥ | ë³µì¡í•¨ | ìµœì‹  DB ì—”ì§„ |

### 9.7 epoll ê¸°ë°˜ ì„œë²„ ì˜ˆì‹œ

```c
// Linux epollì„ ì‚¬ìš©í•œ ëŒ€ê·œëª¨ ì—°ê²° ì²˜ë¦¬

#include <sys/epoll.h>
#include <fcntl.h>

#define MAX_EVENTS 10000

int main() {
    int server_fd = socket(AF_INET, SOCK_STREAM, 0);
    
    // Non-blocking ëª¨ë“œ ì„¤ì •
    fcntl(server_fd, F_SETFL, O_NONBLOCK);
    
    // ì†Œì¼“ ì˜µì…˜
    int opt = 1;
    setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));
    
    // ë°”ì¸ë“œ & ë¦¬ìŠ¨
    bind(server_fd, ...);
    listen(server_fd, 65535);  // í° backlog
    
    // epoll ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    int epoll_fd = epoll_create1(0);
    
    // ì„œë²„ ì†Œì¼“ì„ epollì— ë“±ë¡
    struct epoll_event ev;
    ev.events = EPOLLIN | EPOLLET;  // Edge Triggered
    ev.data.fd = server_fd;
    epoll_ctl(epoll_fd, EPOLL_CTL_ADD, server_fd, &ev);
    
    struct epoll_event events[MAX_EVENTS];
    
    while (1) {
        // ì´ë²¤íŠ¸ ëŒ€ê¸° (ìµœëŒ€ 10,000ê°œ ë™ì‹œ ì²˜ë¦¬)
        int nfds = epoll_wait(epoll_fd, events, MAX_EVENTS, -1);
        
        for (int i = 0; i < nfds; i++) {
            if (events[i].data.fd == server_fd) {
                // ìƒˆ ì—°ê²° ìˆ˜ë½
                while (1) {
                    int client_fd = accept(server_fd, NULL, NULL);
                    if (client_fd == -1) break;  // EAGAIN
                    
                    fcntl(client_fd, F_SETFL, O_NONBLOCK);
                    
                    ev.events = EPOLLIN | EPOLLET;
                    ev.data.fd = client_fd;
                    epoll_ctl(epoll_fd, EPOLL_CTL_ADD, client_fd, &ev);
                }
            } else {
                // í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ì²˜ë¦¬
                handle_client(events[i].data.fd);
            }
        }
    }
}
```

### 9.8 í”„ë¡œë•ì…˜ ì„œë²„ ë¦¬ì†ŒìŠ¤ ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# === 1. FD ì œí•œ í™•ì¸ ===
$ ulimit -n                    # í”„ë¡œì„¸ìŠ¤ ì œí•œ (65535 ê¶Œì¥)
$ cat /proc/sys/fs/file-max   # ì‹œìŠ¤í…œ ì œí•œ (2097152 ê¶Œì¥)

# === 2. í˜„ì¬ FD ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ ===
$ ls /proc/$(pidof nginx)/fd | wc -l   # íŠ¹ì • í”„ë¡œì„¸ìŠ¤ì˜ FD ìˆ˜
$ cat /proc/sys/fs/file-nr             # ì‹œìŠ¤í…œ ì „ì²´ FD í˜„í™©

# === 3. ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì œí•œ ===
$ sysctl net.core.somaxconn           # Accept Queue (65535 ê¶Œì¥)
$ sysctl net.ipv4.tcp_max_syn_backlog # SYN Queue (65535 ê¶Œì¥)

# === 4. ë©”ëª¨ë¦¬ ê´€ë ¨ ===
$ sysctl vm.max_map_count             # mmap ì œí•œ (65535+ ê¶Œì¥)
```

**í”„ë¡œë•ì…˜ ì„¤ì • í…œí”Œë¦¿:**

```bash
# /etc/sysctl.d/99-high-performance.conf

# FD ì œí•œ
fs.file-max = 2097152
fs.nr_open = 2097152

# ë„¤íŠ¸ì›Œí¬ í
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535

# ë©”ëª¨ë¦¬
vm.max_map_count = 262144

# TCP íŠœë‹
net.ipv4.tcp_tw_reuse = 1
net.ipv4.ip_local_port_range = 10000 65535
```

```bash
# /etc/security/limits.d/99-nofile.conf
*    soft    nofile    65535
*    hard    nofile    65535
root soft    nofile    65535
root hard    nofile    65535
```

### 9.9 ì •ë¦¬: C10K â†’ C10M ë¬¸ì œ í•´ê²°

| ë³‘ëª© | ì¦ìƒ | í•´ê²°ì±… |
|------|------|--------|
| **FD ì œí•œ** | Too many open files | `ulimit -n`, `fs.file-max` |
| **Accept Queue** | Connection refused | `somaxconn`, `backlog` |
| **ë©”ëª¨ë¦¬** | OOM Killer | Event Loop ëª¨ë¸ ì „í™˜ |
| **Context Switch** | CPU 100% ì¸ë° ì²˜ë¦¬ëŸ‰ ë‚®ìŒ | Non-blocking I/O |
| **í¬íŠ¸ ê³ ê°ˆ** | Cannot assign address | `tcp_tw_reuse`, ì»¤ë„¥ì…˜ í’€ |

---

### Next Step

ë™ì‹œì„± ë¬¸ì œë¥¼ ë‹¤ë£¨ë‹¤ ë³´ë©´ ìì—°ìŠ¤ëŸ½ê²Œ **"ê·¸ëŸ¼ I/O ì‘ì—…(DB ì¡°íšŒ, ë„¤íŠ¸ì›Œí¬)ì„ ê¸°ë‹¤ë¦´ ë•Œ ìŠ¤ë ˆë“œëŠ” ë­ í•˜ë‚˜?"**ë¼ëŠ” ì˜ë¬¸ì´ ìƒê¹ë‹ˆë‹¤.

ì´ì™€ ì—°ê²°ë˜ëŠ” **[I/O ëª¨ë¸] Sync/Async vs Blocking/Non-blocking** ì£¼ì œë¡œ ë„˜ì–´ê°€ì„œ, Node.jsë‚˜ Redisê°€ ì‹±ê¸€ ìŠ¤ë ˆë“œì„ì—ë„ ì™œ ê·¸ë ‡ê²Œ ë¹ ë¥¸ì§€(ì´ë²¤íŠ¸ ë£¨í”„) ì •ë¦¬í•´ ë“œë¦´ê¹Œìš”?

> **ê´€ë ¨ ë¬¸ì„œ:**
> - `../02-network/tcp-performance-tuning.md`: TCP ì»¤ë„ íŒŒë¼ë¯¸í„° íŠœë‹
> - `../02-network/tcp-vs-udp/README.md`: ì†Œì¼“ í”„ë¡œê·¸ë˜ë° ì‹¤ë¬´ íŒ¨í„´
