# 🔤 문자 인코딩: 왜 내 텍스트가 깨질까?

> **이 문서의 목표:** 문자 깨짐(Mojibake) 현상의 원인을 정확히 이해하고, 시스템(DB, 서버, 브라우저) 전반에서 **올바른 인코딩 전략(UTF-8)**을 수립하여 텍스트 데이터의 무결성을 지킨다.

---

## 0. 핵심 질문으로 시작하기

1.  **문자 집합(Charset)과 인코딩(Encoding)의 차이는?** → 문자 집합은 "문자의 목록(코드표)", 인코딩은 그 코드를 "컴퓨터에 저장하는 방식(변환 규칙)"이다.
2.  **UTF-8이 현대의 표준이 된 이유는?** → 영문은 1바이트로 효율적으로, 다국어는 가변 길이(1~4바이트)로 모두 표현 가능하며 ASCII와 호환되기 때문.
3.  **한글이 깨지는 가장 흔한 원인은?** → UTF-8로 저장된 데이터를 EUC-KR(또는 반대)로 읽으려 할 때 비트 해석이 어긋나서 발생.
4.  **MySQL에서 이모지가 저장이 안 되는 이유는?** → 기본 `utf8`이 3바이트까지만 지원하기 때문. 4바이트 이모지를 쓰려면 `utf8mb4`를 써야 함.

---

## 1. [개념 정의]: 텍스트는 숫자의 나열일 뿐 (Why)

컴퓨터는 '가', 'A' 같은 글자를 모릅니다. 오직 0과 1만 압니다.
따라서 **"이 숫자는 'A'로 하자"**는 약속(Map)이 필요한데, 이 약속이 시스템마다 달라서 문자 깨짐(Mojibake)이 발생합니다.

### 1.1 대표적인 깨짐 현상
*   ** (Replacement Character)**: "모르는 글자야" (UTF-8 해석 오류)
*   **믜, 퍞 (Strange Hangul)**: 바이트가 밀려서 엉뚱한 한글로 조합됨 (EUC-KR vs UTF-8 불일치)

---

## 2. [원리/구조]: 유니코드와 UTF-8 (How)

### 2.1 문자 집합 vs 인코딩
*   **문자 집합 (Unicode)**: "전 세계 모든 문자에 고유 번호(Code Point)를 붙이자." (`U+AC00` = '가')
    *   *이건 그냥 번호표입니다. 저장 방식이 아닙니다.*
*   **인코딩 (UTF-8)**: "그 번호를 컴퓨터 메모리에 어떻게 0과 1로 넣을까?"
    *   *실제 저장 방식입니다.*

### 2.2 UTF-8의 저장 방식 (가변 길이)
UTF-8은 문자의 크기에 따라 방의 크기를 조절합니다.

| 문자 종류 | 크기 | 예시 | 비트 구조 |
| :--- | :--- | :--- | :--- |
| **ASCII (영어/숫자)** | 1 byte | 'A' | `0xxxxxxx` |
| **유럽어 등** | 2 bytes | '©' | `110xxxxx 10xxxxxx` |
| **한글/한자** | 3 bytes | '가' | `1110xxxx 10xxxxxx 10xxxxxx` |
| **이모지 (Emoji)** | 4 bytes | '🔥' | `11110xxx 10xxxxxx ...` |

> [!NOTE]
> **핵심 통찰:** UTF-8은 ASCII(1바이트)와 완벽하게 호환됩니다. 그래서 영문 위주 문서에서는 용량이 적고, 한글 등은 3바이트를 씁니다.

---

## 3. [실전/구현]: 개발자가 챙겨야 할 설정 (What)

### 3.1 데이터베이스 (MySQL/MariaDB)

**🚨 문제 상황**: 이모지(🔥)를 넣었는데 에러(`Incorrect string value`)가 나거나 `?`로 저장됨.
**✅ 해결책**: `utf8mb4` 사용.

```sql
-- 데이터베이스 생성 시
CREATE DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 테이블 생성 시
CREATE TABLE mytable (
    message VARCHAR(255)
) CHARACTER SET utf8mb4;
```
*   MySQL의 `utf8`은 "짝퉁(3바이트)"입니다. 반드시 **`utf8mb4`**를 써야 합니다.

### 3.2 웹 헤더 (HTML/HTTP)
브라우저에게 "이 파일은 UTF-8이야"라고 알려줘야 합니다.

```html
<!-- HTML 파일 헤더 -->
<meta charset="UTF-8">
```

### 3.3 프로그래밍 (문자열 길이 주의)
언어마다 문자열 길이를 세는 기준이 다를 수 있습니다.

```python
s = "A가🔥"
print(len(s))              # 3 (글자 수 - Python 3)
print(len(s.encode('utf-8'))) # 8 (1 + 3 + 4 바이트)
```
DB 컬럼 크기(`VARCHAR(N)`)를 잡을 때 바이트 기준인지 글자 수 기준인지 확인해야 합니다.

---

## 4. 🎯 1분 요약

1.  **표준 통일**: 세상은 **UTF-8**로 통일되었다. 다른 인코딩(EUC-KR, CP949)은 호환성 목적 외엔 쓰지 마라.
2.  **DB 설정**: MySQL/MariaDB에서는 `utf8` 말고 **`utf8mb4`**를 써야 이모지까지 저장된다.
3.  **인코딩 확인**: 글자가 깨지면 "보내는 쪽"과 "받는 쪽"의 인코딩 설정이 같은지(대부분 UTF-8인지) 확인하라.
4.  **한글 크기**: UTF-8에서 한글은 **3바이트**다. (메모리 계산 시 주의)

---

## 5. 📝 자가 점검 질문

1.  **UTF-8에서 영문 알파벳은 몇 바이트인가?**
    → 1바이트. (ASCII와 동일)
2.  **MySQL에서 `utf8` 대신 `utf8mb4`를 써야 하는 이유는?**
    → MySQL의 `utf8`은 최대 3바이트까지만 지원하여 4바이트인 이모지 등을 저장할 수 없기 때문.
3.  **한글 한 글자는 UTF-8에서 보통 몇 바이트인가?**
    → 3바이트.
4.  **맥(Mac)에서 만든 한글 파일명이 윈도우에서 자소가 분리(ㅇㅏㄴㄴㅕㅇ)되어 보이는 이유는?**
    → 맥은 NFD(자소 분리) 정규화를 쓰고, 윈도우는 NFC(완성형)를 쓰기 때문. (NFC로 변환 필요)
